= render partial: "v2/shared/navbars/edit_ticket_navbar", locals: {title: @ticket.ticket_number, total: @ticket.ticket_items.blank? ? number_to_currency(0) : number_to_currency(Ticket.v2_line_items_total(@ticket.ticket_items))}

.jumbotron{style: 'background-color: #FFFFFF;'}
  .container
    - unless @ticket.description.blank?
      %p.text-center= @ticket.description
    = form_tag v2_ticket_path, method: 'put', id: 'edit_ticket_form', :class => "form-horizontal" do
      = hidden_field_tag "ticket[created_from_trip]", params[:created_from_trip] unless params[:created_from_trip].blank?
      = hidden_field_tag "ticket[session_id]", @ticket_session_id unless @ticket_session_id.blank?
      = hidden_field_tag "ticket[ticket_number]", @ticket.ticket_number
      = hidden_field_tag "ticket[status]", @ticket.ticket_status
      - unless @ticket.account_payable_line_items.blank?
        %p
          Amount Due:
          - @ticket.account_payable_line_items.each do |account_payable_line_item|
            = number_to_currency(account_payable_line_item.amount_due_in_assigned_currency)
        - if @ticket.ticket_status == 'PAID'
          %p
            = "Payment by #{payment_method_string(@ticket.account_payable_line_items.first.payment_method)}: #{number_to_currency(@ticket.account_payable_line_items.first.paid_amount)}"
          - if @apcashier['PaymentMethod'] == '1'
            = "Check Number: #{@apcashier['CheckNumber']}"

      #vendor_accordion.panel-group{"aria-multiselectable" => "true", :role => "tablist"}
        .panel.panel-default
          %div.panel-heading{:role => "tab", id: "vendor_heading"}
            %h4.panel-title
              %a.text-primary{"aria-controls" => "collapseVendor", "aria-expanded" => "true", "data-parent" => "#vendor_accordion", "data-toggle" => "collapse", :href => "#collapseVendor", :role => "button" }
                #vendor_name.text-primary
                  - if not (@ticket.customer.first_name.blank? and @ticket.customer.last_name.blank?)
                    = "#{@ticket.customer.first_name} #{@ticket.customer.last_name}"
                  - else
                    = "#{@ticket.customer.company.blank? ? 'No company name' : @ticket.customer.company}"
          %div{id: "collapseVendor", "aria-labelledby" => "headingOne", :role => "tabpanel", class: "panel-collapse collapse ", "aria-expanded" => false }
            .panel-body
              = select_tag "ticket[customer_id]", options_for_select([ ["#{@ticket.customer.first_name} #{@ticket.customer.last_name}", @ticket.customer.id] ], @ticket.customer.id), prompt: 'Choose a customer', class: "", style: "width: 100%;", required: true
              = hidden_field_tag "ticket[description]", "#{@ticket.description.blank? ? "" : @ticket.description}"
      - unless @ticket.ticket_items.blank?
        / Line items
        %div.v2_ticket_input_fields_wrap
          #items_accordion.panel-group{"aria-multiselectable" => "true", :role => "tablist"}
            - @ticket.ticket_items.each do |ticket_item|
              .panel.panel-default.line-item
                %div.panel-heading{:role => "tab", id: "heading#{ticket_item.id}"}
                  %h4.panel-title
                    %ul{class: 'list-inline'}
                      %li
                        %a.line_item_name.text-primary{"aria-controls" => "collapse#{ticket_item.id}", "aria-expanded" => false, "data-parent" => "#items_accordion", "data-toggle" => "collapse", :href => "#collapse_#{ticket_item.id}", :role => "button", class: "collapsed"}
                          = ticket_item.print_description
                      %li.pull-right
                        %a{href: '#', class: 'void_item remove_field', "data-ticket-id" => @ticket.id, "data-session-id" => @ticket_session_id, "data-item-id" => ticket_item.id, "data-commodity-id" => ticket_item.commodity_id, "data-gross" => ticket_item.gross_weight, "data-tare" => ticket_item.tare_weight, "data-net" => ticket_item.net_weight, "data-price" => ticket_item.price, "data-amount" => ticket_item.extended_amount, "data-session-id" => @ticket_session_id}
                          %i.fa.fa-trash.fa-lg.text-danger
                          %i.fa.fa-spinner.fa-spin.fa-lg.text-danger{style: 'display:none;'}
                %div{id: "collapse_#{ticket_item.id}", "aria-labelledby" => "heading#{ticket_item.id}", :role => "tabpanel", class: "panel-collapse collapse ", "aria-expanded" => false }
                  .panel-body
                    = hidden_field_tag "ticket[line_items][][id]", ticket_item.id
                    = hidden_field_tag "ticket[line_items][][status]", ticket_item.ticket_item_status
                    = select_tag "ticket[line_items][][commodity]", options_for_select([ ["#{ticket_item.print_description}", ticket_item.commodity_id] ], ticket_item.commodity_id), prompt: '-- Choose an item --', class: "form-control input-lg v2_item_select", style: "width: 100%;", required: true
                    %br
                    #quantity_form_field{style: "#{ticket_item.unit_of_measure == 'EA' ? 'display:block' : 'display:none'}"}
                      %div.input-group.quantity_input_group
                        %span.input-group-addon
                          %i.fa.fa-hashtag{style: "font-size:0.7em;"}
                        = phone_field_tag "ticket[line_items][][quantity]", number_with_precision(ticket_item.quantity, precision: 1, strip_insignificant_zeros: true), :placeholder => "Quantity", class: "form-control input-lg amount-calculation-field"
                        %span.input-group-addon
                          %a{href: '#', id: 'quantity_picture_button', class: 'quantity_picture_button', 'data-event-code' => "Quantity",  'data-item-name' => ticket_item.print_description, 'data-item-id' => ticket_item.id}
                            %i.fa.fa-upload.fa-2x
                      %br
                    #gross_and_tare_form_field{style: "#{ticket_item.unit_of_measure == 'EA' ? 'display:none' : 'display:block'}"}
                      %div.input-group.gross_input_group
                        - current_user.scale_devices.each do |scale_device|
                          %span.input-group-addon
                            - if scale_device.scale_camera_only?
                              %a{href: '#', style: "color: hotpink;", class: "scale_camera_trigger", id: 'gross_scale_button', 'data-event-code' => "Gross", 'data-ticket-number' => @ticket.ticket_number, 'data-item-name' => ticket_item.print_description, 'data-yard-id' => current_yard_id, 'data-device-id' => scale_device.id, title: scale_device.DeviceName, 'data-customer-id' => @ticket.customer.id }
                                %i.fa.fa-camera.fa-lg
                                %i.fa.fa-spinner.fa-lg.fa-spin{style: 'display:none;'}
                            - else
                              %a{href: '#', class: "scale_read_and_camera_trigger", id: 'gross_scale_button', 'data-event-code' => "Gross", 'data-ticket-number' => @ticket.ticket_number, 'data-item-name' => ticket_item.print_description, 'data-yard-id' => current_yard_id, 'data-device-id' => scale_device.id, title: scale_device.DeviceName, 'data-customer-id' => @ticket.customer.id }
                                %i.fa.fa-dashboard.fa-lg
                                %i.fa.fa-spinner.fa-lg.fa-spin{style: 'display:none;'}
                        %span.input-group-addon
                          %i.fa.fa-plus{style: "font-size:0.7em;"}
                        = phone_field_tag "ticket[line_items][][gross]", number_with_precision(ticket_item.gross_weight, precision: 2, strip_insignificant_zeros: true), :placeholder => "Gross", class: "form-control input-lg amount-calculation-field"
                        %span.input-group-addon
                          %a{href: '#', id: 'gross_picture_button', class: 'gross_or_tare_picture_button', 'data-event-code' => "Gross",  'data-event-code-id' => current_user.company.gross_event_code_id, 'data-weight' => ticket_item.gross_weight, 'data-item-name' => ticket_item.print_description, 'data-item-id' => ticket_item.id}
                            %i.fa.fa-upload.fa-2x
                      %br
                      %div.input-group.tare_input_group
                        - current_user.scale_devices.each do |scale_device|
                          %span.input-group-addon
                            - if scale_device.scale_camera_only?
                              %a{href: '#', style: "color: hotpink;", class: "scale_camera_trigger", id: 'tare_scale_button', 'data-event-code' => "Tare", 'data-ticket-number' => @ticket.ticket_number, 'data-item-name' => ticket_item.print_description, 'data-yard-id' => current_yard_id, 'data-device-id' => scale_device.id, title: scale_device.DeviceName, 'data-customer-id' => @ticket.customer.id }
                                %i.fa.fa-camera.fa-lg
                                %i.fa.fa-spinner.fa-lg.fa-spin{style: 'display:none;'}
                            - else
                              %a{href: '#', class: "scale_read_and_camera_trigger", id: 'tare_scale_button', 'data-event-code' => "Tare", 'data-ticket-number' => @ticket.ticket_number, 'data-item-name' => ticket_item.print_description, 'data-yard-id' => current_yard_id, 'data-device-id' => scale_device.id, title: scale_device.DeviceName, 'data-customer-id' => @ticket.customer.id }
                                %i.fa.fa-dashboard.fa-lg
                                %i.fa.fa-spinner.fa-lg.fa-spin{style: 'display:none;'}
                        %span.input-group-addon
                          %i.fa.fa-minus{style: "font-size:0.7em;"}
                        = phone_field_tag "ticket[line_items][][tare]", number_with_precision(ticket_item.tare_weight, precision: 2, strip_insignificant_zeros: true), :placeholder => "Tare", class: "form-control input-lg amount-calculation-field tare"
                        %span.input-group-addon
                          %a{href: '#', id: 'tare_picture_button', class: 'gross_or_tare_picture_button', 'data-event-code' => "Tare", 'data-event-code-id' => current_user.company.tare_event_code_id, 'data-weight' => ticket_item.tare_weight, 'data-item-name' => ticket_item.print_description, 'data-item-id' => ticket_item.id}
                            %i.fa.fa-upload.fa-2x
                      %br
                      = hidden_field_tag "ticket[line_items][][net]", ticket_item.net_weight, :placeholder => "Net", class: "form-control input-lg amount-calculation-field", readonly: true
                    .input-group
                      %span.input-group-addon
                        %i.fa.fa-dollar.fa-lg
                      = text_field_tag "ticket[line_items][][price]", ticket_item.price, :placeholder => "Price", class: "form-control input-lg amount-calculation-field", required: true
                      %span.input-group-addon
                        %i.fa.fa-balance-scale.fa-lg
                      = select_tag "ticket[line_items][][unit_of_measure]", options_for_select(units_of_measure_abbreviations, ticket_item.unit_of_measure), class: "form-control input-lg amount-calculation-field", required: true
                    = hidden_field_tag "ticket[line_items][][amount]", ticket_item.extended_amount, :placeholder => "Amount", class: "form-control input-lg amount", required: true, readonly: true
                    - unless ticket_item.ticket_item_taxes.blank?
                      - ticket_item.ticket_item_taxes.each_with_index do |tax, index|
                        - unless tax.tax_amount == '0.00'
                          = hidden_field_tag "ticket[line_items][][tax_amount_#{index+1}]", tax.tax_amount, :placeholder => "Tax Amount", class: "form-control input-lg amount-calculation-field tax", readonly: true
                      - ticket_item.ticket_item_taxes.each_with_index do |tax, index|
                        - unless tax.tax_percent == '0.00'
                          = hidden_field_tag "ticket[line_items][][tax_percent_#{index+1}]", tax.tax_percent.to_f/100, :placeholder => "Tax Percent", class: "form-control input-lg amount-calculation-field", readonly: true
                    - else
                      = hidden_field_tag "ticket[line_items][][tax_amount_1]", '0.00', :placeholder => "Tax Amount 1", class: "form-control input-lg amount-calculation-field tax", readonly: true
                      = hidden_field_tag "ticket[line_items][][tax_amount_2]", '0.00', :placeholder => "Tax Amount 2", class: "form-control input-lg amount-calculation-field tax", readonly: true
                      = hidden_field_tag "ticket[line_items][][tax_amount_3]", '0.00', :placeholder => "Tax Amount 3", class: "form-control input-lg amount-calculation-field tax", readonly: true
                      = hidden_field_tag "ticket[line_items][][tax_percent_1]", '0.00', :placeholder => "Tax Percent 1", class: "form-control input-lg", readonly: true
                      = hidden_field_tag "ticket[line_items][][tax_percent_2]", '0.00', :placeholder => "Tax Percent 2", class: "form-control input-lg", readonly: true
                      = hidden_field_tag "ticket[line_items][][tax_percent_3]", '0.00', :placeholder => "Tax Percent 3", class: "form-control input-lg", readonly: true
                    %br
                    = render partial: 'more_line_item_options', locals: {ticket_item: ticket_item, id: "#{ticket_item.id}"}
                        
                .panel-footer{style: 'padding-top: 0px; font-size: 16px;'}
                  .calculation_details
                    - if ticket_item.unit_of_measure == 'EA'
                      %strong Quantity:
                      = "#{number_with_precision(ticket_item.quantity, :precision => 1, strip_insignificant_zeros: true)}"
                    - else
                      %strong Gross:
                      = "#{number_with_precision(ticket_item.gross_weight, :precision => 2, strip_insignificant_zeros: true)}"
                      &nbsp;
                      %strong Tare:
                      = "#{number_with_precision(ticket_item.tare_weight, :precision => 2, strip_insignificant_zeros: true)}"
                      &nbsp;
                      %strong Net:
                      = "#{number_with_precision(ticket_item.net_weight, :precision => 2, strip_insignificant_zeros: true)} LB"
                    &nbsp;
                    = "$#{number_with_precision(ticket_item.price, :precision => 3, strip_insignificant_zeros: true)}/#{ticket_item.unit_of_measure}"
                    &nbsp;
                    %strong= "$#{ticket_item.extended_amount}"
                  / Deduction weights
                  .weight_deduction_details
                    - unless ticket_item.ticket_item_deductions.blank?
                      - ticket_item_weight_deductions_total = 0
                      - ticket_item.ticket_item_deduction.each do |ticket_item_deduction|
                        - unless (ticket_item_deduction.deduct_weight.blank? or ticket_item_deduction.deduct_weight.to_i.zero?)
                          - ticket_item_weight_deductions_total = ticket_item_weight_deductions_total + ticket_item_deduction.deduct_weight.to_f
                      - if ticket_item_weight_deductions_total > 0
                        %strong Deduction:
                        = "#{number_with_precision(ticket_item_weight_deductions_total, :precision => 3, strip_insignificant_zeros: true)} LB"
                  / Deduction dollar amounts
                  .dollar_amount_deduction_details
                    - unless ticket_item.ticket_item_deductions.blank?
                      - ticket_item_dollar_deductions_total = 0
                      - ticket_item.ticket_item_deductions.each do |ticket_item_deduction|
                        - unless (ticket_item_deduction.deduct_dollar_amount.blank? or ticket_item_deduction.deduct_dollar_amount.to_i.zero?)
                          - ticket_item_dollar_deductions_total = ticket_item_dollar_deductions_total + ticket_item_deduction.deduct_dollar_amount.to_f
                      - if ticket_item_dollar_deductions_total > 0
                        %strong Deduction:
                        = "$#{number_with_precision(ticket_item_dollar_deductions_total, :precision => 2, strip_insignificant_zeros: true)}"
                  - unless ticket_item.ticket_item_taxes.blank?
                    / Taxes
                    .tax_details
                      %strong Taxes
                      - ticket_item.ticket_item_taxes.each do |tax|
                        - unless tax.tax_amount == '0.00'
                          = "$#{tax.tax_amount}"
      - else
        / New item
        %div.v2_ticket_input_fields_wrap.new_item
          #items_accordion.panel-group{"aria-multiselectable" => "true", :role => "tablist"}
            .panel.panel-default.line-item  
              - new_item_id = SecureRandom.uuid
              %div.panel-heading{:role => "tab", id: "heading#{new_item_id}"}
                %h4.panel-title
                  %ul{class: 'list-inline'}
                    %li
                      %a.line_item_name.text-primary{"aria-controls" => "collapse#{new_item_id}", "aria-expanded" => true, "data-toggle" => "collapse", :href => "#collapse_#{new_item_id}", :role => "button", class: "ticket_collapse_link" }
                        Choose an item*
                    %li.pull-right
                      %a{href: '#', class: 'remove_field', "data-ticket-id" => @ticket.id, "data-item-id" => new_item_id, "data-commodity-id" => params[:commodity_id], "data-gross" => 0, "data-tare" => 0, "data-net" => 0, "data-price" => 0, "data-amount" => 0, "data-session-id" => @ticket_session_id}
                        %i.fa.fa-trash.fa-lg.text-danger
                        %i.fa.fa-spinner.fa-spin.fa-lg.text-danger{style: 'display:none;'}
              %div{id: "collapse_#{new_item_id}", "aria-labelledby" => "heading#{new_item_id}", :role => "tabpanel", class: "panel-collapse collapse in", "aria-expanded" => true }
                .panel-body
                  = hidden_field_tag "ticket[line_items][][id]", new_item_id
                  = hidden_field_tag "ticket[line_items][][status]", nil
                  = select_tag "ticket[line_items][][commodity]", options_for_select([]), prompt: '-- Choose an item --', class: "form-control input-lg v2_item_select", style: "width: 100%;", required: true, "data-ticket-id" => @ticket.id, "data-item-id" => new_item_id, "data-session-id" => @ticket_session_id
                  %br
                  #quantity_form_field{style: 'display:none'}
                    %div.input-group.quantity_input_group
                      %span.input-group-addon
                        %i.fa.fa-hashtag{style: "font-size:0.7em;"}
                      = phone_field_tag "ticket[line_items][][quantity]", 1, :placeholder => "Quantity", class: "form-control input-lg amount-calculation-field"
                      %span.input-group-addon
                        %a{href: '#', id: 'quantity_picture_button', class: 'quantity_picture_button', 'data-event-code' => "Quantity"}
                          %i.fa.fa-upload.fa-2x
                    %br
                  #gross_and_tare_form_field{style: 'display:block'}
                    %div.input-group.gross_input_group
                      - current_user.scale_devices.each do |scale_device|
                        %span.input-group-addon
                          - if scale_device.scale_camera_only?
                            %a{href: '#', style: "color: hotpink;", class: "scale_camera_trigger", id: 'gross_scale_button', 'data-event-code' => "Gross", 'data-ticket-number' => @ticket_number, 'data-item-name' => '', 'data-yard-id' => current_yard_id, 'data-device-id' => scale_device.id, title: scale_device.DeviceName, 'data-customer-id' => @ticket['CustomerId'] }
                              %i.fa.fa-camera.fa-lg
                              %i.fa.fa-spinner.fa-lg.fa-spin{style: 'display:none;'}
                          - else
                            %a{href: '#', class: "scale_read_and_camera_trigger", id: 'gross_scale_button', 'data-event-code' => "Gross", 'data-ticket-number' => @ticket_number, 'data-item-name' => '', 'data-yard-id' => current_yard_id, 'data-device-id' => scale_device.id, title: scale_device.DeviceName, 'data-customer-id' => @ticket['CustomerId'] }
                              %i.fa.fa-dashboard.fa-lg
                              %i.fa.fa-spinner.fa-lg.fa-spin{style: 'display:none;'}
                      %span.input-group-addon
                        %i.fa.fa-plus{style: "font-size:0.7em;"}
                      = phone_field_tag "ticket[line_items][][gross]", 0, :placeholder => "Gross", class: "form-control input-lg amount-calculation-field", required: true
                      %span.input-group-addon
                        %a{href: '#', id: 'gross_picture_button', class: 'gross_or_tare_picture_button', 'data-event-code' => "Gross", 'data-event-code-id' => current_user.company.gross_event_code_id, 'data-weight' => 0}
                          %i.fa.fa-upload.fa-2x
                    %br
                    %div.input-group.tare_input_group
                      - current_user.scale_devices.each do |scale_device|
                        %span.input-group-addon
                          - if scale_device.scale_camera_only?
                            %a{href: '#', style: "color: hotpink;", class: "scale_camera_trigger", id: 'tare_scale_button', 'data-event-code' => "Tare", 'data-ticket-number' => @ticket_number, 'data-item-name' => '', 'data-yard-id' => current_yard_id, 'data-device-id' => scale_device.id, title: scale_device.DeviceName, 'data-customer-id' => @ticket['CustomerId'] }
                              %i.fa.fa-camera.fa-lg
                              %i.fa.fa-spinner.fa-lg.fa-spin{style: 'display:none;'}
                          - else
                            %a{href: '#', class: "scale_read_and_camera_trigger", id: 'tare_scale_button', 'data-event-code' => "Tare", 'data-ticket-number' => @ticket_number, 'data-item-name' => '', 'data-yard-id' => current_yard_id, 'data-device-id' => scale_device.id, title: scale_device.DeviceName, 'data-customer-id' => @ticket['CustomerId'] }
                              %i.fa.fa-dashboard.fa-lg
                              %i.fa.fa-spinner.fa-lg.fa-spin{style: 'display:none;'}
                      %span.input-group-addon
                        %i.fa.fa-minus{style: "font-size:0.7em;"}
                      = phone_field_tag "ticket[line_items][][tare]", 0, :placeholder => "Subtract", class: "form-control input-lg amount-calculation-field tare", required: true
                      %span.input-group-addon
                        %a{href: '#', id: 'tare_picture_button', class: 'gross_or_tare_picture_button', 'data-event-code' => "Tare", 'data-event-code-id' => current_user.company.tare_event_code_id, 'data-weight' => 0}
                          %i.fa.fa-upload.fa-2x
                    %br
                    = hidden_field_tag "ticket[line_items][][net]", 0, :placeholder => "Net", class: "form-control input-lg amount-calculation-field", required: true, readonly: true
                  .input-group
                    %span.input-group-addon
                      %i.fa.fa-dollar.fa-lg
                    = text_field_tag "ticket[line_items][][price]", 0, :placeholder => "Price", class: "form-control input-lg amount-calculation-field", required: true
                    %span.input-group-addon
                      %i.fa.fa-balance-scale.fa-lg
                    = select_tag "ticket[line_items][][unit_of_measure]", options_for_select(units_of_measure_abbreviations), class: "form-control input-lg amount-calculation-field", required: true
                  = hidden_field_tag "ticket[line_items][][amount]", 0, :placeholder => "Amount", class: "form-control input-lg amount", required: true, readonly: true
                  = hidden_field_tag "ticket[line_items][][tax_amount_1]", '0.00', :placeholder => "Tax Amount 1", class: "form-control input-lg amount-calculation-field tax", readonly: true
                  = hidden_field_tag "ticket[line_items][][tax_amount_2]", '0.00', :placeholder => "Tax Amount 2", class: "form-control input-lg amount-calculation-field tax", readonly: true
                  = hidden_field_tag "ticket[line_items][][tax_amount_3]", '0.00', :placeholder => "Tax Amount 3", class: "form-control input-lg amount-calculation-field tax", readonly: true
                  = hidden_field_tag "ticket[line_items][][tax_percent_1]", '0.00', :placeholder => "Tax Percent 1", class: "form-control input-lg", readonly: true
                  = hidden_field_tag "ticket[line_items][][tax_percent_2]", '0.00', :placeholder => "Tax Percent 2", class: "form-control input-lg", readonly: true
                  = hidden_field_tag "ticket[line_items][][tax_percent_3]", '0.00', :placeholder => "Tax Percent 3", class: "form-control input-lg", readonly: true
                  %br
                  = render partial: 'more_line_item_options', locals: {ticket_item: nil, id: "#{new_item_id}"}
              %div.panel-footer{style: 'padding-top: 0px; font-size: 16px;'}
                .calculation_details
                .deduction_details
                / Deduction weights
                .weight_deduction_details
                / Deduction dollar amounts
                .dollar_amount_deduction_details
                / Taxes
                .tax_details
      .row.form-group{id: 'calculating', style: 'display:none;'}
        %div.col-xs-12
          %h5.text-center
            %i.fa.fa-spinner.fa-spin.fa-2x
            Calculating...
      .row.form-group{id: 'hold_close_pay_buttons'}
        - unless @ticket.ticket_status == 'PAID'
          %div.col-xs-3.col-sm-3
            = image_tag("ajax-loader.gif", :id => "spinner", :alt => "Loading ...", style: "display:none;")
            - unless mobile_device?
              %a{ href: line_item_fields_tickets_path(ticket_number: @ticket.ticket_number, ticket_id: @ticket.id, session_id: @ticket_session_id), 'data-remote' => true, id: "add_item_button", class: "btn btn-warning btn-lg btn-block", onclick: "$(this).hide(); $('#spinner').show();" }
                %i.fa.fa-plus
                Item
            - else
              %a{ href: line_item_fields_tickets_path(ticket_number: @ticket.ticket_number, ticket_id: @ticket.id, session_id: @ticket_session_id), 'data-remote' => true, id: "add_item_button", class: "btn btn-warning btn-block", onclick: "$(this).hide(); $('#spinner').show();" }
                %i.fa.fa-plus
                Item
        %div.col-xs-3.col-sm-3
          - unless mobile_device?
            = button_tag(:type => 'submit', :class => 'btn btn-primary btn-lg btn-block', id: 'save_button', name: 'save', data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> Hold"}, onclick: "$(this).closest('.form-group').find('#close_and_pay_button').removeAttr('data-disable-with'); $(this).closest('.form-group').find('#close_button').removeAttr('data-disable-with'); $(this).closest('.form-group').find('#pay_button').removeAttr('data-disable-with');") do
              %i.fa.fa-check.fa-lg
              - if @ticket.ticket_status == 'HOLD'
                = 'Hold'
              - else
                = 'Save'
          - else
            = button_tag(:type => 'submit', :class => 'btn btn-primary btn-block', id: 'save_button', name: 'save', data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> Hold"}, onclick: "$(this).closest('.form-group').find('#close_and_pay_button').removeAttr('data-disable-with'); $(this).closest('.form-group').find('#close_button').removeAttr('data-disable-with'); $(this).closest('.form-group').find('#pay_button').removeAttr('data-disable-with');") do
              - unless mobile_device?
                %i.fa.fa-check.fa-lg
              - if @ticket.ticket_status == 'HOLD'
                Hold
              - else
                Save
        %div.col-xs-3.col-sm-3
          - unless mobile_device?
            - if @ticket.ticket_status == 'HOLD'
              = button_tag(close_ticket: true, :type => 'submit', :class => 'btn btn-info btn-lg btn-block', id: 'close_button', name: 'close_ticket', data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> Close"}, autocomplete: "off", onclick: "$(this).closest('.form-group').find('#close_and_pay_button').removeAttr('data-disable-with'); $(this).closest('.form-group').find('#save_button').removeAttr('data-disable-with');") do
                %i.fa.fa-folder.fa-lg
                = 'Close'
            - if @ticket.ticket_status == 'CLOSED'
              %a.btn.btn-success.btn-lg.btn-block{href: "#payment_form", id: 'payment_modal_link', "data-toggle" => "modal", title: "Pay"}
                %i.fa.fa-dollar.fa-lg
                = 'Pay'
          - else
            - if @ticket.ticket_status == 'HOLD'
              = button_tag(close_ticket: true, :type => 'submit', :class => 'btn btn-info btn-block', id: 'close_button', name: 'close_ticket', data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> Close"}, autocomplete: "off", onclick: "$(this).closest('.form-group').find('#close_and_pay_button').removeAttr('data-disable-with'); $(this).closest('.form-group').find('#save_button').removeAttr('data-disable-with');") do
                - unless mobile_device?
                  %i.fa.fa-folder.fa-lg
                Close
            - if @ticket.ticket_status == 'CLOSED'
              %a.btn.btn-success.btn-block{href: "#payment_form", id: 'payment_modal_link', "data-toggle" => "modal", title: "Pay"}
                - unless mobile_device?
                  %i.fa.fa-dollar.fa-lg
                Pay
        - unless mobile_device? 
          - if @ticket.ticket_status == 'HOLD'
            %div.col-xs-3.col-sm-3
              %a.btn.btn-success.btn-lg.btn-block{href: "#payment_form", id: 'payment_modal_link', "data-toggle" => "modal", title: "Pay"}
                %i.fa.fa-dollar.fa-lg
                = 'Pay'
        - else
          - if @ticket.ticket_status == 'HOLD'
            %div.col-xs-3.col-sm-3
              %a.btn.btn-success.btn-block{href: "#payment_form", id: 'payment_modal_link', "data-toggle" => "modal", title: "Pay"}
                - unless mobile_device?
                  %i.fa.fa-dollar.fa-lg
                Pay
        = render partial: "payment_modal"
            
    %hr
    - unless @ticket.ticket_status == 'PAID'
      .row
        .pull-right
          .col-xs-12.col-sm-2.col-md-2
            %p= link_to '<i class="fa fa-warning"></i> Void'.html_safe, v2_ticket_path(@ticket.id, status: @ticket.ticket_status, session_id: @ticket_session_id), :method => :delete, :data => { :confirm => 'Are you sure you want to void this ticket?', disable_with: "<i class='fa fa-spinner fa-spin'></i> Void" }, class: 'btn btn-sm btn-danger'
      
    %div#images

    - @images_array.each_slice(6) do |images|
      .row
        - images.each do |image|
          - unless image['HIDDEN'] == '1' or not current_user.view_images?
            .col-xs-12.col-sm-2.col-md-2
              .thumbnail
                %a{href: image_path(image['CAPTURE_SEQ_NBR']), class: 'thumbnail'}
                  = image_tag(show_preview_image_image_path(image['CAPTURE_SEQ_NBR']), alt: image['CAPTURE_SEQ_NBR'], class: 'img-responsive', loading: 'lazy')
                .text-center
                  %small.text-muted= image['EVENT_CODE']
    
= render partial: "v2/shared/ticket_footer_navbar", locals: {title: "Ticket"}

:javascript
  var open_new_customer_modal;
  open_new_customer_modal = function() {
    $('#new_customer_modal').modal('show');
    $('#ticket_customer_id').select2("close");
  };