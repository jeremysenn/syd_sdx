= render partial: "v2/shared/navbars/show_customer_navbar", locals: {title: "#{@customer.first_name} #{@customer.last_name}"}
.jumbotron{style: 'background-color: #FFFFFF;'}
  .container
    - if current_user.admin? and current_user.company.include_external_users?
      - unless @customer_users.blank?
        .alert.alert-warning
          %p.lead
            %i.fa.fa-compress
            = "Customer Portal Open"
          - @customer_users.each do |customer_user|
            %p= link_to customer_user.name, edit_user_path(@customer_user), class: 'btn btn-default'
    %div.panel.panel-primary
      .panel-heading
        %h5.panel-title
          Customer Info
      %div.list_group
        %div.list-group-item
          %strong= "Number:"
          .pull-right
            = "#{@customer.customer_number}"
        %div.list-group-item
          %strong= "First Name:"
          .pull-right
            = "#{@customer.first_name}"
        %div.list-group-item
          %strong= "Last Name:"
          .pull-right
            = "#{@customer.last_name}"
        %div.list-group-item
          %strong= "Company:"
          .pull-right
            = "#{@customer.company}"
        %div.list-group-item
          %strong= "Phone:"
          .pull-right
            = "#{@customer.phone}"
    %div.panel.panel-primary
      .panel-heading
        %h5.panel-title
          Address
      %div.panel-body
        = "#{@customer.address1}"
        - unless @customer.address2.blank?
          %br
          = "#{@customer.address2}"
        %br
        = "#{@customer.city}, #{@customer.state} #{@customer.zip}" unless @customer.city.blank? and @customer.state.blank? and @customer.zip.blank?
    %div.panel.panel-primary
      .panel-heading
        %h5.panel-title
          Identification
      %div.list_group
        %div.list-group-item
          %strong= "ID Number:"
          .pull-right
            = "#{@customer.id_number}"
        %div.list-group-item
          %strong= "ID State:"
          .pull-right
            = "#{@customer.id_state}"
        %div.list-group-item
          %strong= "ID Expiration:"
          .pull-right
            - unless @customer.id_expires.blank?
              = "#{@customer.id_expires.to_date.strftime("%m/%d/%Y")}" 
            - else
              Not set

    %div.panel.panel-primary
      .panel-heading
        %h5.panel-title
          Taxes
      %div.list_group
        - unless @customer.customer_sales_taxes.blank?
          - @customer.customer_sales_taxes.each do |customer_sales_tax|
            - customer_sales_tax.sales_tax_type.sales_taxes.each do |sales_tax|
              %div.list-group-item
                %strong= "#{sales_tax.tax_name} Tax Percent:"
                .pull-right
                  = sales_tax.tax_percent
        - else
          %div.list-group-item None

    %hr
    %p.lead Customer Pictures
    %div#cust_pics
    - unless @cust_pics_array.blank?
      - @cust_pics_array.each_slice(6) do |cust_pics|
        .row
          - cust_pics.each do |cust_pic|
            .col-xs-12.col-sm-2.col-md-2
              .thumbnail
                %a{href: cust_pic_path(cust_pic['CAPTURE_SEQ_NBR']), class: 'thumbnail'}
                  = image_tag(show_preview_image_cust_pic_path(cust_pic['CAPTURE_SEQ_NBR']), alt: cust_pic['CAPTURE_SEQ_NBR'], class: 'img-responsive')
                .text-center
                  %small.text-muted= cust_pic['EVENT_CODE']
    - else
      .row
        .col-xs-12
          None
    - unless @customer_users.blank?
      %ul.nav.nav-tabs
        %br
        %li.active
          %a{:href => "#tickets", :data => {:toggle => "tab"}}
            = "Tickets"
        - unless @workorders.blank?
          %li
            %a{:href => "#workorders", :data => {:toggle => "tab"}}
              = "Service Requests"
      .tab-content
        .tab-pane.active{:id => "tickets"}
          .embed-responsive.embed-responsive-4by3
            %iframe.embed-responsive-item{:src => "#{reports_url}?customer_id=#{@customer.id}"}
        - unless @workorders.blank?
          .tab-pane{:id => "workorders"}
            %br
            %div{id: "workorders_list"}
              - @workorders.each do |workorder|
                %div.row
                  .col-xs-12.col-sm-12.col-md-12
                    %div.panel.panel-primary
                      %div.list_group
                        %a{href: v2_workorder_path(workorder.id, workorder: workorder), class: "list-group-item workorder_button", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> #{workorder.work_order_number}"}}
                          %ul.list-inline
                            %li= workorder.work_order_number
                            %li= "<b>Driver</b> #{workorder.trip.driver.first_name} #{workorder.trip.driver.last_name}".html_safe unless workorder.trip.blank? or workorder.trip.driver.blank? or (workorder.trip.driver.first_name.blank? and workorder.trip.driver.last_name.blank?)
                            %li= "<b>Truck</b> #{workorder.trip.truck.truck_number}".html_safe unless workorder.trip.blank? or workorder.trip.truck.blank? or workorder.trip.truck.truck_number.blank?
                            %li= workorder.work_order_date.to_date.strftime("%m/%d/%y")
                            %li= Workorder.status(workorder.work_order_status)
                            .pull-right
                              %i.fa.fa-chevron-right.fa-lg
            .row
              .text-center
                %div{id: 'endless_page'}
                  %p= image_tag("ajax-loader.gif", :id => "more_workorders_spinner", :alt => "Loading ...", style: "display:none;")
                  %p= link_to 'Load more ...', customer_path(@customer['Id'], page: @workorders.next_page), :class => 'load-more-workorders btn btn-default', :remote => true, :onclick => "$(this).hide(); $('#more_workorders_spinner').show();" if @workorders.next_page

    - else
      %br
      %ul.nav.nav-tabs
        %li.active
          %a{:href => "#closed_tickets", :data => {:toggle => "tab"}}
            = "Closed Tickets"
        %li
          %a{:href => "#paid_tickets", :data => {:toggle => "tab"}}
            = "Paid Tickets"
        - unless @workorders.blank?
          %li
            %a{:href => "#workorders", :data => {:toggle => "tab"}}
              = "Service Requests"
      .tab-content
        .tab-pane.active{:id => "closed_tickets"}
          %br
          - unless @closed_tickets.blank?
            - @closed_tickets.each do |ticket|
              %div.row
                .col-xs-12.col-sm-12.col-md-12
                  %div.panel.panel-primary
                    %div.list_group
                      %a{href: v2_ticket_path(ticket.id, status: ticket.ticket_status), class: "list-group-item ticket_button", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> #{ticket.ticket_number}"}}
                        .pull-right
                          = number_to_currency(Ticket.v2_line_items_total(ticket.ticket_items)) unless ticket.ticket_items.blank?
                          %i.fa.fa-chevron-right.fa-lg
                        - if current_user.user_setting.show_ticket_thumbnails? and Image.where(ticket_nbr: ticket.ticket_number.to_s, yardid: current_yard_id, event_code: "Gross").count > 0
                          = image_tag(Image.where(ticket_nbr: ticket.ticket_number, yardid: current_yard_id, event_code: "Gross").last.preview_data_uri, class: 'thumbnail img-responsive')
                        = ticket.ticket_number
                      %a{href: v2_ticket_path(ticket.id, status: ticket.ticket_status, now: DateTime.now, format: 'pdf'), class: "list-group-item", target: '_blank'}
                        = ticket.date_created.to_date.strftime("%m/%d/%y")
                        .pull-right
                          %i.fa.fa-file-pdf-o.fa-lg
                          Print
          - else
            None

        .tab-pane{:id => "paid_tickets"}
          %br
          - unless @paid_tickets.blank?
            - @paid_tickets.each do |ticket|
              %div.row
                .col-xs-12.col-sm-12.col-md-12
                  %div.panel.panel-primary
                    %div.list_group
                      %a{href: v2_ticket_path(ticket.id, status: ticket.ticket_status), class: "list-group-item ticket_button", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> #{ticket.ticket_number}"}}
                        .pull-right
                          = number_to_currency(Ticket.v2_line_items_total(ticket.ticket_items)) unless ticket.ticket_items.blank?
                          %i.fa.fa-chevron-right.fa-lg
                        -#
                          - if current_user.user_setting.show_ticket_thumbnails? and Image.where(ticket_nbr: ticket.ticket_number.to_s, yardid: current_yard_id, event_code: "Gross").count > 0
                            = image_tag(Image.where(ticket_nbr: ticket.ticket_number, yardid: current_yard_id, event_code: "Gross").last.preview_data_uri, class: 'thumbnail img-responsive')
                        = ticket.ticket_number
                      %a{href: v2_ticket_path(ticket.id, status: ticket.ticket_status, now: DateTime.now, format: 'pdf'), class: "list-group-item", target: '_blank'}
                        = ticket.date_created.to_date.strftime("%m/%d/%y")
                        .pull-right
                          %i.fa.fa-file-pdf-o.fa-lg
                          Print
          - else
            %p None
        - unless @workorders.blank?
          .tab-pane{:id => "workorders"}
            %br
            %div{id: "workorders_list"}
              - @workorders.each do |workorder|
                %div.row
                  .col-xs-12.col-sm-12.col-md-12
                    %div.panel.panel-primary
                      %div.list_group
                        %a{href: v2_workorder_path(workorder.id, workorder: workorder), class: "list-group-item workorder_button", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> #{workorder.work_order_number}"}}
                          %ul.list-inline
                            %li= workorder.work_order_number
                            %li= "<b>Driver</b> #{workorder.trip.driver.first_name} #{workorder.trip.driver.last_name}".html_safe unless workorder.trip.blank? or workorder.trip.driver.blank? or (workorder.trip.driver.first_name.blank? and workorder.trip.driver.last_name.blank?)
                            %li= "<b>Truck</b> #{workorder.trip.truck.truck_number}".html_safe unless workorder.trip.blank? or workorder.trip.truck.blank? or workorder.trip.truck.truck_number.blank?
                            %li= workorder.work_order_date.to_date.strftime("%m/%d/%y")
                            %li= Workorder.status(workorder.work_order_status)
                            .pull-right
                              %i.fa.fa-chevron-right.fa-lg
            .row
              .text-center
                %div{id: 'endless_page'}
                  %p= image_tag("ajax-loader.gif", :id => "more_workorders_spinner", :alt => "Loading ...", style: "display:none;")
                  %p= link_to 'Load more ...', v2_customer_path(@customer.id, page: @workorders.next_page), :class => 'load-more-workorders btn btn-default', :remote => true, :onclick => "$(this).hide(); $('#more_workorders_spinner').show();" if @workorders.next_page

= render partial: "v2/shared/customer_footer_navbar", locals: {title: "Customer"}