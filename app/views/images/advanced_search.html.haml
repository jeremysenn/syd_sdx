= render partial: "shared/navbars/advanced_search_navbar", locals: {title: "Advanced Search"}

.container
  %br
  .well
    = search_form_for @search, url: advanced_search_images_path, method: :get do |f|
      = f.condition_fields do |c|
        = render "condition_fields", f: c
      %p= link_to_add_fields "Add Conditions", f, :condition
      %hr
      %div.row.form-group
        %div{:class => "col-xs-12 col-sm-4 col-md-4"}
          = button_tag(:type => 'submit', :class => 'btn btn-primary btn-lg', data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> Search"}) do
            Search
  - if @images.blank?
    .jumbotron
      %p.text-center No results found
  - else
    %div{id: "images"}
      %p.text-muted
        = "#{@search.result.count} results found"
      - @images.each_slice(6) do |images|
        %div.row
          - images.each do |image|
            .col-xs-12.col-sm-2.col-md-2
              %div.panel.panel-primary
                %div.list_group
                  %a{href: image_path(image), class: "list-group-item"}
                    - unless image.hidden? or not current_user.show_thumbnails?
                      = image_tag(image.preview_data_uri, alt: image.id, class: 'thumbnail img-responsive')
                    = image.ticket_nbr
                    .pull-right
                      %i.fa.fa-chevron-right
                    - unless image.event_code.blank?
                      %br/
                      %small= image.event_code
                    - unless image.camera_name.blank?
                      %br/
                      %small= image.camera_name
                    %br/
                    %small.text-muted= image.sys_date_time.strftime("%-m/%-d/%y %l:%M %p")
  .row
    .text-center
      %div{id: 'endless_page'}
        %p= image_tag("ajax-loader.gif", :id => "more_images_spinner", :alt => "Loading ...", style: "display:none;")
        %p= link_to 'Load more ...', advanced_search_images_path(:page => @images.next_page, :q => params[:q], :one_image_per_ticket => params[:one_image_per_ticket]), :class => 'load-more-images btn btn-default', :remote => true, :onclick => "$(this).hide(); $('#more_images_spinner').show();" if @images.next_page
  
= render partial: "shared/footer_navbar", locals: {title: "Images"}
