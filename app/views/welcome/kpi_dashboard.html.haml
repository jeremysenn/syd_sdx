= render 'shared/navbars/kpi_dashboard_navbar'

.jumbotron{id: 'kpi_dashboard', style: 'background-color: black;'}
  .container-fluid
    .row
      .pull-right
        .col-xs-12.col-sm-4
          = form_tag welcome_kpi_dashboard_path, method: 'get', :class => "form-inline", role: 'search' do
            %p= select_tag :yard_id, options_for_select(@yards.collect {|yard| [ yard['Name'], yard['Id'] ] }, current_yard_id), class: "form-control input-lg", onchange: "this.form.submit();"
    .row
      .col-xs-12
        .col-xs-12.col-sm-3
          .panel{style: 'background-color: #303030; color: white;'}
            .panel-heading
              Held Today
              %h3
                = "#{@held_tickets_today.blank? ? 0 : @held_tickets_today.count}"
                %br
                Tickets

            -#
              - unless @held_tickets_today.blank?
                %table.table
                  - @held_tickets_today.each do |ticket|
                    %tr
                      %td= ticket['TicketNumber']
                      %td= number_to_currency(ticket['TicketItemCollection'].blank? ? 0 : Ticket.line_items_total(ticket['TicketItemCollection']['ApiTicketItem']))
              - else
                .panel-body None
        .col-xs-12.col-sm-3
          .panel{style: 'background-color: #303030; color: white;'}
            .panel-heading
              Paid Today
              %h3
                = "#{@paid_tickets_today.blank? ? 0 : @paid_tickets_today.count}"
                %br
                Tickets
            -#
              - unless @paid_tickets_today.blank?
                %table.table
                  - @paid_tickets_today.each do |ticket|
                    %tr
                      %td= ticket['TicketNumber']
                      %td= number_to_currency(ticket['TicketItemCollection'].blank? ? 0 : Ticket.line_items_total(ticket['TicketItemCollection']['ApiTicketItem']))
              - else
                .panel-body None  
        .col-xs-12.col-sm-6
          .panel{style: 'background-color: #303030; color: white;'}
            .panel-heading
              Daily Tickets
            - unless @held_tickets_today.blank?
              %table.table
                - @held_tickets_today.each do |ticket|
                  %tr
                    %td= ticket['TicketNumber']
                    %td= ticket['Company']
                    %td= number_to_currency(ticket['TicketItemCollection'].blank? ? 0 : Ticket.line_items_total(ticket['TicketItemCollection']['ApiTicketItem']))
            - else
              .panel-body None
    .row
      .col-xs-12
        .col-xs-12.col-sm-3
          .panel{style: 'background-color: #303030; color: white;'}
            .panel-heading
              Held Today
              %h3
                = "#{@held_shipments_today.blank? ? 0 : @held_shipments_today.count}"
                %br
                Shipments
            -#
              - unless @held_shipments_today.blank?
                %table.table
                  - @held_shipments_today.each do |shipment|
                    %tr
                      %td= shipment['ShipmentNumber']
                      %td= shipment['CustomerName']
              - else
                .panel-body None
        .col-xs-12.col-sm-3
          .panel{style: 'background-color: #303030; color: white;'}
            .panel-heading
              Sent Today
              %h3
                = "#{@closed_shipments_today.blank? ? 0 : @closed_shipments_today.count}"
                %br
                Shipments
            -#
              - unless @closed_shipments_today.blank?
                %table.table
                  - @closed_shipments_today.each do |shipment|
                    %tr
                      %td= shipment['ShipmentNumber']
                      %td= shipment['CustomerName']
              - else
                .panel-body None
        .col-xs-12.col-sm-6
          .panel{style: 'background-color: #303030; color: white;'}
            .panel-heading
              Daily Shipments
            - unless @closed_shipments_today.blank?
              %table.table
                - @held_shipments_today.each do |shipment|
                  %tr
                    %td= shipment['ShipmentNumber']
                    %td= shipment['CustomerName']
                    %td= shipment['ContractDescription']
                    %td= "#{shipment['NetWeight']}#{shipment['UnitOfMeasure']}"
            - else
              .panel-body None

:javascript
  // Refresh page every 5 minutes
  setInterval(function(){
   window.location.reload(1);
  }, 300000);