= render partial: "shared/navbars/show_customer_navbar", locals: {title: "#{@customer['FirstName']} #{@customer['LastName']}"}
-#
.well
  %p= @customer
.jumbotron{style: 'background-color: #FFFFFF;'}
  .container
    - if current_user.admin?
      - unless @customer_user.blank?
        .alert.alert-warning
          %i.fa.fa-compress
          = "Customer has outside access"
          = link_to "Edit customer login", edit_user_path(@customer_user), class: 'btn btn-default'
      -#
        .alert.alert-warning
          = link_to "Create customer login", "#new_user_form", "data-toggle" => "modal", class: 'btn btn-default'
        = render partial: 'users/new_modal'
      -#
        - if @customer.photo_id_warning?
          .alert.alert-warning
            %i.fa.fa-warning.fa-lg
            Customer Photo ID is missing or expired.
    %div.panel.panel-primary
      %div.list_group
        %div.list-group-item
          %strong= "Number:"
          .pull-right
            = "#{@customer['CustomerNumber']}"
        %div.list-group-item
          %strong= "First Name:"
          .pull-right
            = "#{@customer['FirstName']}"
        %div.list-group-item
          %strong= "Last Name:"
          .pull-right
            = "#{@customer['LastName']}"
        %div.list-group-item
          %strong= "Company:"
          .pull-right
            = "#{@customer['Company']}"
        %div.list-group-item
          %strong= "Phone:"
          .pull-right
            = "#{@customer['Phone']}"
    %div.panel.panel-primary
      %div.panel-body
        %strong= "Address:"
        %br
        = "#{@customer['Address1']}"
        - unless @customer['Address2'].blank?
          %br
          = "#{@customer['Address2']}"
        %br
        = "#{@customer['City']}, #{@customer['State']} #{@customer['Zip']}" unless @customer['City'].blank? and @customer['State'].blank? and @customer['Zip'].blank?
    %div.panel.panel-primary
      %div.list_group
        %div.list-group-item
          %strong= "ID Number:"
          .pull-right
            = "#{@customer['IdNumber']}"
        %div.list-group-item
          %strong= "ID State:"
          .pull-right
            = "#{@customer['IdState']}"
        %div.list-group-item
          %strong= "ID Expiration:"
          .pull-right
            - unless @customer['IdExpires'] == {"i:nil"=>"true"}
              = "#{@customer['IdExpires'].to_date.strftime("%m/%d/%Y")}" 
            - else
              Not set correctly

    %hr
    %p.lead Customer Pictures
    %div#cust_pics

    %div{id: 'endless_page'}
      %p= image_tag("ajax-loader.gif", :id => "more_images_spinner", :alt => "Loading ...", style: "display:none;")
      %p= link_to 'More pictures ...', cust_pics_path(:page => nil, :q => {cust_nbr_eq: @customer['Id'], yardid_eq: current_yard_id}), :class => 'load-more-cust-pics btn btn-default', :remote => true, :onclick => "$(this).hide(); $('#more_images_spinner').show();"
      %p= link_to 'Re-load pictures ...', cust_pics_path(:page => nil, :q => {cust_nbr_eq: @customer['Id'], yardid_eq: current_yard_id}), :class => 'reload-cust-pics btn btn-default', :remote => true, :onclick => "$(this).hide(); $('#more_images_spinner').show(); $('#cust_pics').empty(); $('a.load-more-cust-pics').attr('href', '<%= cust_pics_path page: @cust_pics.next_page, q: params[:q] %>');", style: "display:none;"

    %hr
    %p.lead Paid Tickets
    %div#tickets
      - unless @paid_tickets.blank?
        %div{id: "tickets"}
          - @paid_tickets.each do |ticket|
            %div.row
              .col-xs-12.col-sm-12.col-md-12
                %div.panel.panel-primary
                  %div.list_group
                    -# unless current_user.customer?
                    -#
                      %a{href: edit_ticket_path(ticket['Id'], status: ticket['Status']), class: "list-group-item ticket_button", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> #{ticket['TicketNumber']} #{ticket['Company']}"}}
                        .pull-right
                          = number_to_currency(ticket["BalanceDue"]) if params[:status] == 'closed'
                          %i.fa.fa-chevron-right.fa-lg
                        - if current_user.user_setting.show_ticket_thumbnails? and Image.where(ticket_nbr: ticket["TicketNumber"], yardid: current_yard_id, event_code: "Gross").count > 0
                          = image_tag(Image.where(ticket_nbr: ticket["TicketNumber"], yardid: current_yard_id, event_code: "Gross").last.preview_data_uri, class: 'thumbnail img-responsive')
                        = ticket["TicketNumber"]
                        - unless ticket["Company"].blank?
                          = ticket["Company"] 
                        - else
                          = "#{ticket['FirstName']} #{ticket['LastName']}"
                    -# else
                    - if true
                      %a{href: ticket_path(ticket['Id'], status: ticket['Status']), class: "list-group-item ticket_button", data: {disable_with: "<i class='fa fa-spinner fa-spin'></i> #{ticket['TicketNumber']}"}}
                        .pull-right
                          = number_to_currency(Ticket.line_items_total(ticket['TicketItemCollection']['ApiTicketItem']))
                          %i.fa.fa-chevron-right.fa-lg
                        - if current_user.user_setting.show_ticket_thumbnails? and Image.where(ticket_nbr: ticket["TicketNumber"], yardid: current_yard_id, event_code: "Gross").count > 0
                          = image_tag(Image.where(ticket_nbr: ticket["TicketNumber"], yardid: current_yard_id, event_code: "Gross").last.preview_data_uri, class: 'thumbnail img-responsive')
                        = ticket["TicketNumber"]
                    %a{href: ticket_path(ticket['Id'], status: ticket['Status'], now: DateTime.now, format: 'pdf'), class: "list-group-item", target: '_blank'}
                      = ticket["DateCreated"].to_date.strftime("%m/%d/%y")
                      .pull-right
                        %i.fa.fa-file-pdf-o.fa-lg
                        Print
      - else
        None

= render partial: "shared/customer_footer_navbar", locals: {title: "Customer"}