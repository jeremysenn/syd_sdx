%p.lead Commodity Summary Report
- @line_items.group_by{ |i| i['PrintDescription'] }.each_with_index do |(line_item_group, line_items), index|
  %div.panel.panel-default
    %div.panel-heading
      %h3.panel-title
        %a.group{"aria-controls" => "collapse#{index}", "aria-expanded" => "true", "data-toggle" => "collapse", :href => "#collapse#{index}", :role => "button"}
          = line_item_group
          #details.text-muted.pull-right
            = "#{line_items.map { |i| i['NetWeight'].to_d }.sum.round}LB"
            = number_to_currency(line_items.map { |i| i['ExtendedAmount'].to_d }.sum)
    %div.panel-collapse.collapse.in{:id => "collapse#{index}", "aria-labelledby" => "headingOne", :role => "tabpanel"}
      %table.table.table-striped.table-responsive
        %thead
          %tr
            %td 
              %strong Date
            %td 
              %strong Ticket
            %td 
              %strong Customer
            %td
              %strong Net (LB)
            %td
              %strong Price
            %td 
              %strong Amount
        %tbody
          - line_items.each do |line_item|
            %tr
              %td= line_item["DateCreated"].to_date.strftime("%m/%d/%y")
              %td= @tickets.find {|ticket| ticket['Id'] == line_item["TicketHeadId"]}["TicketNumber"]
              %td
                - unless @tickets.find {|ticket| ticket['Id'] == line_item["TicketHeadId"]}["Company"].blank?
                  = @tickets.find {|ticket| ticket['Id'] == line_item["TicketHeadId"]}["Company"]
                - else
                  = "#{@tickets.find {|ticket| ticket['Id'] == line_item["TicketHeadId"]}["FirstName"]} #{@tickets.find {|ticket| ticket['Id'] == line_item["TicketHeadId"]}["LastName"]}"
              %td= "#{number_with_precision(line_item['NetWeight'], precision: 2, strip_insignificant_zeros: true)}"
              %td= "#{number_to_currency(line_item['Price'])}"
              %td= "#{number_to_currency(line_item['ExtendedAmount'])}"
              -#
                %td= line_item
          %tr
            %td
            %td
            %td
            %td
              %strong= "#{line_items.map { |i| i['NetWeight'].to_d }.sum.round(3)}"
            %td
            %td
              %strong= number_to_currency(line_items.map { |i| i['ExtendedAmount'].to_d }.sum)


-#
  %table.table.table-striped.table-responsive
    %thead
      %tr
        %td 
          %strong Commodity
        %td 
          %strong Total
    %tbody
      - @line_items.group_by{ |i| i['PrintDescription'] }.each do |line_item_group, line_items|
        %tr
          %td
            = line_item_group
            %ul.list-inline
              - line_items.each do |line_item|
                %li
                  %small= "#{line_item['NetWeight']}LB"
                %li
                  %small= "#{number_to_currency(line_item['Price'])}"
                %br
                =# line_item
          %td
            = number_to_currency(line_items.map { |i| i['ExtendedAmount'].to_d }.sum)
      %tr
        %td
        %td
          %strong Total
          = number_to_currency(@line_items_total)

%hr
  .pull-right
    %p.lead
      Cash
      = number_to_currency(@cash_payment_tickets.map { |t| Ticket.line_items_total(t['TicketItemCollection']['ApiTicketItem']).to_d }.sum)
      %br
      Check
      = number_to_currency(@check_payment_tickets.map { |t| Ticket.line_items_total(t['TicketItemCollection']['ApiTicketItem']).to_d }.sum)
      %br
      %strong Total
      = number_to_currency(@line_items_total)