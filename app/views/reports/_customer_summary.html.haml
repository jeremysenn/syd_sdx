%p.lead Customer Summary Report
- @tickets.group_by{ |t| t['Company']}.each_with_index do |(ticket_group, tickets), index|
  %div.panel.panel-default
    %div.panel-heading
      %h3.panel-title
        %a.group{"aria-controls" => "collapse#{index}", "aria-expanded" => "false", "data-toggle" => "collapse", :href => "#collapse#{index}", :role => "button"}
          = ticket_group
          #details.pull-right
            = number_to_currency(tickets.map { |t| Ticket.line_items_total(t['TicketItemCollection']['ApiTicketItem']).to_d }.sum)
    %div.panel-collapse.collapse{:id => "collapse#{index}", "aria-labelledby" => "headingOne", :role => "tabpanel"}
      %table.table.table-striped.table-responsive
        %thead
          %tr
            %td 
              %strong Date
            %td 
              %strong Ticket
            %td 
              %strong Amount
            -#
              %td
                %strong Ticket record
        %tbody
          - tickets.each do |ticket|
            %tr
              %td= ticket["DateClosed"].to_date.strftime("%m/%d/%y")
              %td= ticket["TicketNumber"]
              %td= number_to_currency(Ticket.line_items_total(ticket['TicketItemCollection']['ApiTicketItem']))
              -# %td= ticket
          %tr
            %td
            %td
            %td
              %strong= number_to_currency(tickets.map { |t| Ticket.line_items_total(t['TicketItemCollection']['ApiTicketItem']).to_d }.sum)
%hr
  .pull-right
    %p.lead
      %strong Total
      = number_to_currency(@line_items_total)